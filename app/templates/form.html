<!-- app/templates/form.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>🐝 Spelling Bee Solver</title>
  <link rel="alternate icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
  <div class="container">
    <h1>🐝 Spelling Bee Solver</h1>
    <p>Today's letters: <span id="todaysLetters"></span></p>

    <form id="puzzleForm">
      <label for="prefixInput">Enter the first 2+ letters:</label>
      <input type="text" id="prefixInput" minlength="2" maxlength="7" required pattern="[a-zA-Z]{2,7}" />
      <button type="submit" id="solveBtn" disabled>Solve Puzzle</button>
    </form>

    <div id="result" style="display:none;">
      <h2>Words Found: <span id="wordCount"></span></h2>
      <div id="pangrams"></div>

      <input type="text" id="searchBox" placeholder="Start typing to filter..." />
      <ul id="wordList"></ul>
    </div>

    <div id="error" class="error"></div>
  </div>

  <script>
    let allWords = [];
    let todaysLetters = "";

    // Fetch today's letters from the backend
    async function fetchLetters() {
      const resp = await fetch("/letters");
      const data = await resp.json();
      if (data.letters && data.letters.length === 7) {
        todaysLetters = data.letters.join(" ");
        document.getElementById("todaysLetters").textContent = todaysLetters;
      } else {
        document.getElementById("todaysLetters").textContent = "Not loaded yet.";
      }
    }
    fetchLetters();

    const prefixInput = document.getElementById("prefixInput");
    const solveBtn = document.getElementById("solveBtn");

    prefixInput.addEventListener("input", () => {
      solveBtn.disabled = prefixInput.value.length < 2;
    });

    document.getElementById("puzzleForm").onsubmit = async (e) => {
      e.preventDefault();
      const prefix = prefixInput.value.trim().toLowerCase();

      const resp = await fetch("/solve", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prefix })
      });

      const data = await resp.json();
      if (resp.ok && data.words) {
        allWords = data.words;
        displayResults(data);
      } else {
        showError(data.error || "Unknown error");
      }
    };

    function displayResults(data) {
      document.getElementById("error").style.display = "none";
      document.getElementById("result").style.display = "block";

      document.getElementById("wordCount").textContent = data.count;

      const pangramEl = document.getElementById("pangrams");
      if (data.pangrams.length > 0) {
        pangramEl.innerHTML = `<p>🎯 Pangram: <strong>${data.pangrams.join(", ")}</strong></p>`;
      } else {
        pangramEl.innerHTML = "";
      }

      displayWords(allWords);
    }

    function displayWords(words) {
      const ul = document.getElementById("wordList");
      ul.innerHTML = "";
      if (words.length === 0) {
        ul.innerHTML = "<li><em>No words found.</em></li>";
        return;
      }
      words.forEach(word => {
        const li = document.createElement("li");
        li.textContent = word;
        ul.appendChild(li);
      });
    }

    document.getElementById("searchBox").oninput = () => {
      const q = document.getElementById("searchBox").value.toLowerCase();
      if (q === "") {
        displayWords(allWords);
      } else {
        displayWords(allWords.filter(w => w.startsWith(q)));
      }
    };

    function showError(msg) {
      const el = document.getElementById("error");
      el.textContent = "❌ " + msg;
      el.style.display = "block";
      document.getElementById("result").style.display = "none";
    }
  </script>
</body>
</html>
